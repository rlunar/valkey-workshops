{% extends "base.html" %}

{% block title %}Cache Management - Flask Caching Demo{% endblock %}

{% block content %}
<div class="cache-management">
    <h1>Cache Management</h1>
    <p>Manually clear cache entries or warm the cache with frequently accessed data.</p>
    
    <div class="management-sections">
        <div class="section">
            <h2>Clear Cache</h2>
            <p>Remove cached data using patterns or clear all cache entries.</p>
            
            <form method="POST" class="cache-form">
                <div class="form-group">
                    <label for="pattern">Cache Pattern:</label>
                    <select name="pattern" id="pattern" onchange="updatePatternDescription()">
                        <option value="all">Clear All Cache</option>
                        <option value="products:*">All Product Data</option>
                        <option value="products:list:*">Product Listings</option>
                        <option value="product:detail:*">Individual Products</option>
                        <option value="categories:*">Category Data</option>
                        <option value="stats:*">Statistics Cache</option>
                        <option value="route:*">Route Cache</option>
                        <option value="func:*">Function Cache</option>
                    </select>
                </div>
                
                <div class="pattern-description" id="pattern-description">
                    <p><strong>Clear All Cache:</strong> Removes all cached data and resets statistics.</p>
                </div>
                
                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to clear the selected cache?')">
                    Clear Cache
                </button>
            </form>
        </div>
        
        <div class="section">
            <h2>Cache Warming</h2>
            <p>Preload frequently accessed data into the cache.</p>
            
            <div class="warming-actions">
                <a href="{{ url_for('main.warm_cache') }}" class="btn btn-primary">
                    Warm Cache Now
                </a>
                <p class="warming-note">
                    This will cache all products, categories, and the first few pages of product listings.
                </p>
            </div>
        </div>
        
        <div class="section">
            <h2>Cache Patterns</h2>
            <p>Understanding the cache key patterns used in this application:</p>
            
            <div class="patterns-list">
                <div class="pattern-item">
                    <code>products:list:page_X:per_page_Y</code>
                    <p>Product listing pages with pagination</p>
                </div>
                
                <div class="pattern-item">
                    <code>product:detail:ID</code>
                    <p>Individual product details</p>
                </div>
                
                <div class="pattern-item">
                    <code>product:related:ID</code>
                    <p>Related products for a specific product</p>
                </div>
                
                <div class="pattern-item">
                    <code>categories:all</code>
                    <p>All category data for filters</p>
                </div>
                
                <div class="pattern-item">
                    <code>stats:database_counts</code>
                    <p>Database statistics (product/category counts)</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="actions">
        <a href="{{ url_for('main.cache_stats') }}" class="btn btn-secondary">View Cache Statistics</a>
        <a href="{{ url_for('main.index') }}" class="btn btn-secondary">Back to Home</a>
    </div>
</div>

<script>
function updatePatternDescription() {
    const select = document.getElementById('pattern');
    const description = document.getElementById('pattern-description');
    const descriptions = {
        'all': '<p><strong>Clear All Cache:</strong> Removes all cached data and resets statistics.</p>',
        'products:*': '<p><strong>All Product Data:</strong> Clears all product-related cache including listings and details.</p>',
        'products:list:*': '<p><strong>Product Listings:</strong> Clears cached product listing pages and pagination data.</p>',
        'product:detail:*': '<p><strong>Individual Products:</strong> Clears cached individual product details and related products.</p>',
        'categories:*': '<p><strong>Category Data:</strong> Clears cached category information used in filters.</p>',
        'stats:*': '<p><strong>Statistics Cache:</strong> Clears cached database statistics and counts.</p>',
        'route:*': '<p><strong>Route Cache:</strong> Clears cached route responses.</p>',
        'func:*': '<p><strong>Function Cache:</strong> Clears cached function results.</p>'
    };
    
    description.innerHTML = descriptions[select.value] || '';
}
</script>
{% endblock %}